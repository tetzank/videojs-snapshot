/*! videojs-snapshot 2018-09-05 */

function snapshot(a){function b(){var a=j.getBoundingClientRect(),b=u.el().width/a.width,c=u.el().height/a.height;h=Math.max(Math.max(b,c),1),r.el().innerHTML=Math.round(1/h*100)/100+"x"}function c(a){m.el().querySelector(".vjs-tool-active").classList.remove("vjs-tool-active"),a.target.classList.add("vjs-tool-active"),p=a.target.dataset.value,y.hide()}function d(a){var b=document.createElement("canvas");b.width=u.el().width,b.height=u.el().height;var c=b.getContext("2d");c.drawImage(s.el(),0,0),c.drawImage(u.el(),0,0),window.open("").document.write("<html><head><title>snapshot - "+a+'</title></head><body><p>Right-click and save image.</p><img src="'+b.toDataURL(a)+'" /></body></html>')}function e(a,b,c,d,e,f,h,j){var k=new videojs.Component(i,{el:videojs.Component.prototype.createEl("canvas",{})}),l=i.el().getBoundingClientRect();k.el().style.maxWidth=l.width+"px",k.el().style.maxHeight=l.height+"px",k.el().width=e,k.el().height=f;var m=k.el().getContext("2d");return m.drawImage(h.el(),a,b,c,d,0,0,e,f),g.removeChild(h),g.addChild(k),m.lineCap=j.lineCap,m.strokeStyle=j.strokeStyle,m.lineWidth=j.lineWidth,[k,m]}function f(){A&&(A=!1,"rect"==p?(v.drawImage(w.el(),h*w.el().offsetLeft,h*w.el().offsetTop,h*x.canvas.width,h*x.canvas.height),w.hide()):"text"==p&&(i.el().blur(),z.el().focus()))}var g,h,i=this,j=i.el().querySelector("video");i.snap=function(){i.pause(),i.el().blur(),i.controlBar.hide(),m.show(),l.show(),u.el().width=j.videoWidth,u.el().height=j.videoHeight,v.strokeStyle=n.el().value,v.lineWidth=o.el().value/2,v.lineCap="round",b(),s.el().width=j.videoWidth,s.el().height=j.videoHeight,t.drawImage(j,0,0);var a=j.getBoundingClientRect();u.el().style.maxWidth=a.width+"px",u.el().style.maxHeight=a.height+"px",s.el().style.maxWidth=a.width+"px",s.el().style.maxHeight=a.height+"px"};var k=i.controlBar.addChild("button");k.addClass("vjs-snapshot-button"),k.el().title="Take snapshot",k.on("click",i.snap);var l=i.addChild(new videojs.Component(i,{el:videojs.Component.prototype.createEl(null,{className:"vjs-canvas-parent"})})),m=i.addChild(new videojs.Component(i,{el:videojs.Component.prototype.createEl(null,{className:"vjs-control-bar vjs-drawing-ctrl"})}));m.hide();var n=m.addChild(new videojs.Component(i,{el:videojs.Component.prototype.createEl("input",{className:"vjs-control",type:"color",value:"#df4b26",title:"color"})}));n.on("change",function(a){v.strokeStyle=n.el().value});var o=m.addChild(new videojs.Component(i,{el:videojs.Component.prototype.createEl("input",{className:"vjs-control",type:"number",value:"10",title:"line width, text size, ..."})}));o.on("keydown",function(a){a.stopPropagation()}),o.on("change",function(a){v.lineWidth=o.el().value/2});var p="brush";videojs.ToolButton=videojs.Button.extend({init:function(a,b){videojs.Button.call(this,a,b),this.addClass("vjs-drawing-"+b.tool),this.el().dataset.value=b.tool,this.el().title=b.title,this.on("click",c)}}),m.addChild(new videojs.ToolButton(i,{tool:"brush",title:"freehand drawing"})).addClass("vjs-tool-active");m.addChild(new videojs.ToolButton(i,{tool:"rect",title:"draw rectangle from top left to bottom right"})),m.addChild(new videojs.ToolButton(i,{tool:"crop",title:"select area and click selection to crop"})),m.addChild(new videojs.ToolButton(i,{tool:"text",title:"select area, type message and then click somewhere else"})),m.addChild(new videojs.ToolButton(i,{tool:"eraser",title:"erase drawing in clicked location"}));m.addChild(new videojs.Component(i,{el:videojs.Component.prototype.createEl(null,{className:"vjs-control vjs-drawing-scaler",title:"scale image"})})).on("click",function(a){var c=u.el().width,d=u.el().height,f=window.prompt("Current image size is "+c+"x"+d+" . New width?",c);if(f=parseInt(f,10),!isNaN(f)){var g=f/c,h=g*c|0,i=g*d|0,j=e(0,0,c,d,h,i,s,t);s=j[0],t=j[1],j=e(0,0,c,d,h,i,u,v),u=j[0],v=j[1],b()}}),m.addChild(new videojs.Component(i,{el:videojs.Component.prototype.createEl(null,{className:"vjs-control vjs-button",innerHTML:"JPEG",title:"open new tab with jpeg image"})})).on("click",function(){d("image/jpeg")}),m.addChild(new videojs.Component(i,{el:videojs.Component.prototype.createEl(null,{className:"vjs-control vjs-button",innerHTML:"PNG",title:"open new tab with png image"})})).on("click",function(){d("image/png")});var q=m.addChild("button");q.addClass("vjs-drawing-close"),q.el().title="close screenshot and return to video",q.on("click",function(){y.hide(),l.hide(),m.hide(),i.controlBar.show(),i.el().focus()});var r=m.addChild(new videojs.Component(i,{el:videojs.Component.prototype.createEl(null,{className:"vjs-scale",innerHTML:"1",title:"scale factor"})}));g=l.addChild(new videojs.Component(i,{el:videojs.Component.prototype.createEl(null,{className:"vjs-canvas-container"})}));var s=g.addChild(new videojs.Component(i,{el:videojs.Component.prototype.createEl("canvas",{})})),t=s.el().getContext("2d"),u=g.addChild(new videojs.Component(i,{el:videojs.Component.prototype.createEl("canvas",{})})),v=u.el().getContext("2d"),w=g.addChild(new videojs.Component(i,{el:videojs.Component.prototype.createEl("canvas",{})}));w.el().style.zIndex="1";var x=w.el().getContext("2d"),y=g.addChild(new videojs.Component(i,{el:videojs.Component.prototype.createEl("div",{innerHTML:"crop"})}));y.el().style.display="flex",y.on("mousedown",function(a){var c=h*y.el().offsetLeft|0,d=h*y.el().offsetTop|0,f=h*y.el().offsetWidth|0,g=h*y.el().offsetHeight|0,i=e(c,d,f,g,f,g,s,t);s=i[0],t=i[1],i=e(c,d,f,g,f,g,u,v),u=i[0],v=i[1],b(),y.hide(),a.stopPropagation()});var z=g.addChild(new videojs.Component(i,{el:videojs.Component.prototype.createEl("textarea",{})}));z.on("keydown",function(a){a.stopPropagation()}),z.on("blur",function(a){v.fillStyle=n.el().value,v.font=h*o.el().value*2+"px sans-serif",v.textBaseline="top",v.fillText(z.el().value,h*z.el().offsetLeft+h,h*z.el().offsetTop+h),z.hide(),z.el().value=""}),l.hide(),w.hide(),y.hide(),z.hide();var A=!1;g.on("mousedown",function(a){A=!0;var b=g.el().getBoundingClientRect(),c=a.clientX-b.left,d=a.clientY-b.top;switch(p){case"brush":c*=h,d*=h,v.beginPath(),v.moveTo(c-1,d),v.lineTo(c,d),v.stroke();break;case"rect":w.el().width=0,w.el().height=0,w.el().style.left=c+"px",w.el().style.top=d+"px",w.show();break;case"crop":y.el().style.width=0,y.el().style.height=0,y.el().style.left=c+"px",y.el().style.top=d+"px",y.el().style.border="1px dashed "+n.el().value,y.el().style.color=n.el().value,y.show();break;case"text":z.hasClass("vjs-hidden")&&(z.el().style.width=0,z.el().style.height=0,z.el().style.left=c+"px",z.el().style.top=d+"px",z.el().style.border="1px dashed "+n.el().value,z.el().style.color=n.el().value,z.el().style.font=2*o.el().value+"px sans-serif",z.show());break;case"eraser":var e=o.el().value;v.clearRect(h*c-e/2,h*d-e/2,e,e)}}),g.on("mousemove",function(a){if(A){var b=g.el().getBoundingClientRect(),c=a.clientX-b.left,d=a.clientY-b.top;switch(p){case"brush":v.lineTo(h*c,h*d),v.stroke();break;case"rect":x.clearRect(0,0,x.canvas.width,x.canvas.height),w.el().width=c-w.el().offsetLeft,w.el().height=d-w.el().offsetTop,x.strokeStyle=n.el().value,x.lineWidth=o.el().value/h,x.strokeRect(0,0,x.canvas.width,x.canvas.height);break;case"crop":y.el().style.width=c-y.el().offsetLeft+"px",y.el().style.height=d-y.el().offsetTop+"px";break;case"text":z.el().style.width=c-z.el().offsetLeft+"px",z.el().style.height=d-z.el().offsetTop+"px";break;case"eraser":var e=o.el().value;v.clearRect(h*c-e/2,h*d-e/2,e,e)}a.preventDefault()}}),g.on("mouseup",f),g.on("mouseleave",f)}videojs.plugin("snapshot",snapshot);